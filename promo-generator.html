<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mermaid Visualizer - Promotional Materials Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 40px;
            font-size: 2.5rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .section h2 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #ff3670;
        }

        .canvas-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
        }

        .canvas-wrapper {
            text-align: center;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 15px;
        }

        .canvas-wrapper h3 {
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        canvas {
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            max-width: 100%;
            height: auto;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
        }

        .btn {
            background: linear-gradient(135deg, #ff3670, #ff6b9d);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 54, 112, 0.4);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 54, 112, 0.6);
        }

        .upload-area {
            border: 2px dashed rgba(255, 255, 255, 0.5);
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px 0;
        }

        .upload-area:hover {
            border-color: #ff3670;
            background: rgba(255, 54, 112, 0.1);
        }

        .upload-area.dragover {
            border-color: #ff3670;
            background: rgba(255, 54, 112, 0.2);
        }

        #fileInput {
            display: none;
        }

        .animation-container {
            text-align: center;
            margin: 20px 0;
        }

        #animationCanvas {
            background: #1a1a1a;
            border-radius: 12px;
        }

        .animation-controls {
            margin-top: 15px;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff3670, #ff6b9d);
            width: 0%;
            transition: width 0.3s ease;
        }

        .download-links {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .download-link {
            display: none;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            text-decoration: none;
            font-size: 0.9rem;
            transition: background 0.3s ease;
        }

        .download-link:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .download-link.ready {
            display: inline-block;
        }

        .screenshot-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .screenshot-item {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
        }

        .screenshot-item img {
            max-width: 100%;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .specs {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .section {
                padding: 20px;
            }
            
            h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üßú‚Äç‚ôÄÔ∏è Mermaid Visualizer - Promotional Materials</h1>

        <!-- Chrome Web Store Promotional Tiles -->
        <div class="section">
            <h2>üè™ Chrome Web Store Promotional Tiles</h2>
            <div class="specs">
                <strong>Requirements:</strong><br>
                ‚Ä¢ Small Promo Tile: 440√ó280px<br>
                ‚Ä¢ Marquee Promo Tile: 1400√ó560px<br>
                ‚Ä¢ Format: JPEG or 24-bit PNG (no alpha)<br>
                ‚Ä¢ High quality, eye-catching design
            </div>
            
            <div class="canvas-container">
                <div class="canvas-wrapper">
                    <h3>Small Promo Tile (440√ó280)</h3>
                    <canvas id="smallPromoCanvas" width="440" height="280"></canvas>
                </div>
                
                <div class="canvas-wrapper">
                    <h3>Marquee Promo Tile (1400√ó560)</h3>
                    <canvas id="marqueePromoCanvas" width="700" height="280" style="width: 700px; height: 280px;"></canvas>
                </div>
            </div>
            
            <div class="controls">
                <button class="btn" onclick="generatePromoTiles()">üé® Generate Promo Tiles</button>
                <button class="btn" onclick="downloadPromoTiles()">üì• Download All Tiles</button>
            </div>
            
            <div class="download-links" id="promoDownloads"></div>
        </div>

        <!-- Screenshot Processor -->
        <div class="section">
            <h2>üì∏ Screenshot Processor</h2>
            <div class="specs">
                <strong>Requirements:</strong><br>
                ‚Ä¢ Size: 1280√ó800px or 640√ó400px<br>
                ‚Ä¢ Format: JPEG or 24-bit PNG (no alpha)<br>
                ‚Ä¢ High quality, clear demonstration of features
            </div>
            
            <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                <p>üìÅ Click to upload screenshots or drag & drop here</p>
                <p style="font-size: 0.9rem; opacity: 0.7;">Supports: PNG, JPG, JPEG</p>
            </div>
            <input type="file" id="fileInput" multiple accept="image/*">
            
            <div class="screenshot-grid" id="screenshotGrid"></div>
            
            <div class="download-links" id="screenshotDownloads"></div>
        </div>

        <!-- Animation Generator -->
        <div class="section">
            <h2>üé¨ Promotional Animation</h2>
            <div class="specs">
                <strong>Animation Sequence:</strong><br>
                1. Cool intro text with Mermaid Visualizer branding<br>
                2. Show webpage with Mermaid diagram code<br>
                3. Zoom to browser extension toolbar<br>
                4. Click on extension icon<br>
                5. Beautiful diagram appears<br>
                6. Show features (zoom, pan, navigation)<br>
                7. End with call-to-action
            </div>
            
            <div class="animation-container">
                <canvas id="animationCanvas" width="1280" height="720"></canvas>
                <div class="progress-bar">
                    <div class="progress-fill" id="animationProgress"></div>
                </div>
                <div class="animation-controls">
                    <button class="btn" onclick="generateAnimation()">üé¨ Generate Animation</button>
                    <button class="btn" onclick="playAnimation()">‚ñ∂Ô∏è Play</button>
                    <button class="btn" onclick="pauseAnimation()">‚è∏Ô∏è Pause</button>
                    <button class="btn" onclick="exportAnimationFrames()">üì• Export Frames</button>
                </div>
            </div>
            
            <div class="download-links" id="animationDownloads"></div>
        </div>

        <!-- Favicon Generator -->
        <div class="section">
            <h2>üîó Favicon Generator</h2>
            <div class="specs">
                <strong>Favicon Requirements:</strong><br>
                ‚Ä¢ Multiple sizes: 16√ó16, 32√ó32, 48√ó48, 64√ó64px<br>
                ‚Ä¢ ICO format for maximum compatibility<br>
                ‚Ä¢ Clean, recognizable at small sizes
            </div>
            
            <div class="canvas-container">
                <div class="canvas-wrapper">
                    <h3>Favicon Preview</h3>
                    <canvas id="faviconCanvas" width="64" height="64"></canvas>
                </div>
            </div>
            
            <div class="controls">
                <button class="btn" onclick="generateFavicon()">üé® Generate Favicon</button>
                <button class="btn" onclick="downloadFavicon()">üì• Download ICO</button>
            </div>
            
            <div class="download-links" id="faviconDownloads"></div>
        </div>
    </div>

    <script>
        // Global variables
        let animationId = null;
        let currentFrame = 0;
        let isAnimating = false;

        // Global variables for icon
        let iconSvg = null;
        let iconImage = null;

        // Load the real icon SVG
        async function loadRealIcon() {
            try {
                // Try multiple sources for the icon
                const iconSources = [
                    'shared/icon.svg', // Local path
                    'https://raw.githubusercontent.com/IstiN/mermaid_extensions/main/shared/icon.svg' // GitHub raw URL
                ];
                
                for (const iconPath of iconSources) {
                    try {
                        const response = await fetch(iconPath);
                        if (response.ok) {
                            const svgText = await response.text();
                            iconSvg = svgText;
                            
                            // Create image from SVG for canvas use
                            const blob = new Blob([svgText], { type: 'image/svg+xml' });
                            const url = URL.createObjectURL(blob);
                            
                            iconImage = new Image();
                            return new Promise((resolve) => {
                                iconImage.onload = () => {
                                    URL.revokeObjectURL(url);
                                    console.log('‚úÖ Icon loaded successfully from:', iconPath);
                                    resolve();
                                };
                                iconImage.onerror = () => {
                                    URL.revokeObjectURL(url);
                                    console.warn('‚ùå Failed to create image from SVG');
                                    resolve(); // Continue even if image creation fails
                                };
                                iconImage.src = url;
                            });
                        }
                    } catch (fetchError) {
                        console.warn(`Failed to fetch icon from ${iconPath}:`, fetchError);
                        continue; // Try next source
                    }
                }
                
                // If all sources failed, create fallback
                throw new Error('All icon sources failed');
                
            } catch (error) {
                console.error('Could not load icon from any source:', error);
                // Create fallback icon and ensure Promise resolves
                createFallbackIcon();
                return Promise.resolve();
            }
        }

        function createFallbackIcon() {
            const canvas = document.createElement('canvas');
            canvas.width = 128;
            canvas.height = 128;
            const ctx = canvas.getContext('2d');
            
            // Draw our icon manually as fallback
            ctx.fillStyle = '#ff3670';
            ctx.fillRect(1, 1, 126, 126);
            
            // White diagram elements
            ctx.fillStyle = 'white';
            ctx.translate(64, 64);
            
            // Top square
            ctx.fillRect(-15, -36, 30, 18);
            // Middle squares
            ctx.fillRect(-42, -9, 24, 18);
            ctx.fillRect(-12, -9, 24, 18);
            ctx.fillRect(18, -9, 24, 18);
            // Bottom squares
            ctx.fillRect(-32, 18, 22, 16);
            ctx.fillRect(10, 18, 22, 16);
            
            // Lines
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(0, -18);
            ctx.lineTo(0, -9);
            ctx.stroke();
            
            iconImage = new Image();
            iconImage.src = canvas.toDataURL();
        }

        // Generate promotional tiles
        function generatePromoTiles() {
            generateSmallPromo();
            generateMarqueePromo();
        }

        function generateSmallPromo() {
            const canvas = document.getElementById('smallPromoCanvas');
            const ctx = canvas.getContext('2d');
            
            // Professional gradient background (inspired by DMTools banner)
            const gradient = ctx.createLinearGradient(0, 0, 440, 280);
            gradient.addColorStop(0, '#667eea');
            gradient.addColorStop(0.6, '#764ba2');
            gradient.addColorStop(1, '#4facfe');
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 440, 280);
            
            // Draw real icon
            if (iconImage) {
                ctx.drawImage(iconImage, 30, 30, 80, 80);
            }
            
            // Professional typography
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 36px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif';
            ctx.fillText('Mermaid', 130, 60);
            ctx.fillText('Visualizer', 130, 95);
            
            // Clean subtitle
            ctx.font = '18px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif';
            ctx.fillStyle = 'rgba(255, 255, 255, 0.95)';
            ctx.fillText('Transform code into beautiful diagrams', 30, 140);
            
            // Key features (no CTA button)
            const features = [
                '‚ö° One-click visualization',
                'üåê Works on GitHub, Jira, Confluence', 
                'üé® Beautiful SVG rendering'
            ];
            ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif';
            ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            features.forEach((feature, i) => {
                ctx.fillText(feature, 30, 175 + i * 28);
            });
        }

        function generateMarqueePromo() {
            const canvas = document.getElementById('marqueePromoCanvas');
            canvas.width = 1400;
            canvas.height = 560;
            const ctx = canvas.getContext('2d');
            
            // Professional gradient background
            const gradient = ctx.createLinearGradient(0, 0, 1400, 560);
            gradient.addColorStop(0, '#667eea');
            gradient.addColorStop(0.3, '#764ba2');
            gradient.addColorStop(0.7, '#4facfe');
            gradient.addColorStop(1, '#00f2fe');
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 1400, 560);
            
            // Large real icon
            if (iconImage) {
                ctx.drawImage(iconImage, 60, 60, 180, 180);
            }
            
            // Professional main title
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 64px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif';
            ctx.fillText('Mermaid Visualizer', 280, 110);
            
            // Clean subtitle
            ctx.font = '32px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif';
            ctx.fillStyle = 'rgba(255, 255, 255, 0.95)';
            ctx.fillText('Transform Code into Beautiful Diagrams', 280, 160);
            
            // Professional feature list
            const features = [
                '‚ö° One-click visualization on any webpage',
                'üåê Universal compatibility with dev tools',
                'üé® Beautiful SVG rendering with zoom & pan',
                'üîó Direct integration with mermaid.live',
                'üì± Mobile-friendly with touch support',
                'üîí Privacy-first local processing'
            ];
            
            ctx.font = '22px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif';
            ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            features.forEach((feature, i) => {
                const x = (i % 2) * 600 + 280;
                const y = 230 + Math.floor(i / 2) * 45;
                ctx.fillText(feature, x, y);
            });
            
            // Professional tagline (no CTA button)
            ctx.font = 'bold 28px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif';
            ctx.fillStyle = '#ffffff';
            ctx.textAlign = 'center';
            ctx.fillText('The Developer\'s Choice for Diagram Visualization', 700, 480);
            ctx.textAlign = 'left';
            
            // Scale for display
            const displayCanvas = document.getElementById('marqueePromoCanvas');
            displayCanvas.style.width = '700px';
            displayCanvas.style.height = '280px';
        }

        // Download promotional tiles
        function downloadPromoTiles() {
            const smallCanvas = document.getElementById('smallPromoCanvas');
            const marqueeCanvas = document.getElementById('marqueePromoCanvas');
            
            // Ensure canvases have content before enabling downloads
            if (!smallCanvas || !marqueeCanvas) {
                console.error('Canvas elements not found');
                return;
            }
            
            // Show download links (remove auto-download to avoid issues)
            const downloadsDiv = document.getElementById('promoDownloads');
            downloadsDiv.innerHTML = `
                <a href="#" class="download-link ready" onclick="downloadPromoTile('small')">üì• Small Promo Tile PNG</a>
                <a href="#" class="download-link ready" onclick="downloadPromoTile('marquee')">üì• Marquee Promo Tile PNG</a>
                <a href="#" class="download-link ready" onclick="downloadPromoTile('small', 'jpg')">üì• Small Promo Tile JPG</a>
                <a href="#" class="download-link ready" onclick="downloadPromoTile('marquee', 'jpg')">üì• Marquee Promo Tile JPG</a>
            `;
        }

        // Helper function for downloading promo tiles with better error handling
        function downloadPromoTile(type, format = 'png') {
            const canvasId = type === 'small' ? 'smallPromoCanvas' : 'marqueePromoCanvas';
            const canvas = document.getElementById(canvasId);
            
            if (!canvas) {
                alert('Canvas not found. Please regenerate the promotional materials first.');
                return;
            }
            
            // Check if canvas has content
            const ctx = canvas.getContext('2d');
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const hasContent = imageData.data.some(pixel => pixel !== 0);
            
            if (!hasContent) {
                alert('Canvas appears to be empty. Please regenerate the promotional materials first.');
                return;
            }
            
            const mimeType = format === 'jpg' ? 'image/jpeg' : 'image/png';
            const filename = type === 'small' 
                ? `mermaid-visualizer-small-promo-440x280.${format}`
                : `mermaid-visualizer-marquee-promo-1400x560.${format}`;
            
            try {
                downloadCanvasAsImage(canvas, filename, mimeType);
            } catch (error) {
                console.error('Download failed:', error);
                alert('Download failed. Please try again.');
            }
        }

        // Screenshot processing
        document.getElementById('fileInput').addEventListener('change', handleScreenshots);

        // Automatically load our screenshots
        async function loadOurScreenshots() {
            const screenshotPaths = [
                {
                    local: 'screenshots/Screenshot1.png',
                    remote: 'https://raw.githubusercontent.com/IstiN/mermaid_extensions/main/screenshots/Screenshot1.png'
                },
                {
                    local: 'screenshots/Screenshot2.png', 
                    remote: 'https://raw.githubusercontent.com/IstiN/mermaid_extensions/main/screenshots/Screenshot2.png'
                }
            ];
            
            const grid = document.getElementById('screenshotGrid');
            grid.innerHTML = '<p style="color: rgba(255, 255, 255, 0.8); text-align: center;">Loading our screenshots...</p>';
            
            try {
                for (let i = 0; i < screenshotPaths.length; i++) {
                    const paths = screenshotPaths[i];
                    const img = new Image();
                    img.crossOrigin = 'anonymous';
                    
                    // Try loading from local path first, then remote
                    let loaded = false;
                    
                    for (const pathType of ['local', 'remote']) {
                        if (loaded) break;
                        
                        try {
                            await new Promise((resolve, reject) => {
                                img.onload = () => {
                                    createScreenshotCanvas(img, `Screenshot${i + 1}.png`, i);
                                    console.log(`‚úÖ Screenshot ${i + 1} loaded from ${pathType} path`);
                                    loaded = true;
                                    resolve();
                                };
                                img.onerror = () => {
                                    console.warn(`‚ùå Could not load Screenshot${i + 1} from ${pathType}: ${paths[pathType]}`);
                                    reject();
                                };
                                img.src = paths[pathType];
                            });
                        } catch (error) {
                            // Try next path type
                            continue;
                        }
                    }
                    
                    if (!loaded) {
                        console.warn(`‚ùå Failed to load Screenshot${i + 1} from any source`);
                    }
                }
                
                if (grid.querySelector('.screenshot-item')) {
                    grid.querySelector('p').remove(); // Remove loading message
                } else {
                    grid.innerHTML = '<p style="color: rgba(255, 255, 255, 0.6); text-align: center;">Screenshots not found. Please upload manually using the upload area above.</p>';
                }
            } catch (error) {
                console.error('Error loading screenshots:', error);
                grid.innerHTML = '<p style="color: rgba(255, 255, 255, 0.6); text-align: center;">Could not load screenshots. Please upload manually.</p>';
            }
        }

        function handleScreenshots(event) {
            const files = event.target.files;
            processScreenshots(files);
        }

        function processScreenshots(files) {
            const grid = document.getElementById('screenshotGrid');
            grid.innerHTML = '';
            
            Array.from(files).forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        createScreenshotCanvas(img, file.name, index);
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        }

        function createScreenshotCanvas(img, filename, index) {
            const container = document.createElement('div');
            container.className = 'screenshot-item';
            
            // Create canvas for 1280x800
            const canvas1280 = document.createElement('canvas');
            canvas1280.width = 1280;
            canvas1280.height = 800;
            const ctx1280 = canvas1280.getContext('2d');
            
            // Calculate scaling
            const scale = Math.min(1280 / img.width, 800 / img.height);
            const newWidth = img.width * scale;
            const newHeight = img.height * scale;
            const x = (1280 - newWidth) / 2;
            const y = (800 - newHeight) / 2;
            
            // Fill background
            ctx1280.fillStyle = '#ffffff';
            ctx1280.fillRect(0, 0, 1280, 800);
            
            // Draw image
            ctx1280.drawImage(img, x, y, newWidth, newHeight);
            
            // Create canvas for 640x400
            const canvas640 = document.createElement('canvas');
            canvas640.width = 640;
            canvas640.height = 400;
            const ctx640 = canvas640.getContext('2d');
            
            // Scale for 640x400
            const scale640 = Math.min(640 / img.width, 400 / img.height);
            const newWidth640 = img.width * scale640;
            const newHeight640 = img.height * scale640;
            const x640 = (640 - newWidth640) / 2;
            const y640 = (400 - newHeight640) / 2;
            
            // Fill background
            ctx640.fillStyle = '#ffffff';
            ctx640.fillRect(0, 0, 640, 400);
            
            // Draw image
            ctx640.drawImage(img, x640, y640, newWidth640, newHeight640);
            
            // Preview (scaled down)
            const preview = document.createElement('canvas');
            preview.width = 320;
            preview.height = 200;
            preview.style.maxWidth = '100%';
            const previewCtx = preview.getContext('2d');
            previewCtx.drawImage(canvas1280, 0, 0, 320, 200);
            
            container.innerHTML = `
                <h4>Screenshot ${index + 1}</h4>
                <div style="margin: 10px 0;">
                    <button class="btn" onclick="downloadCanvasAsImage(this.parentNode.parentNode.canvas1280, 'screenshot-${index + 1}-1280x800.png')">üì• 1280√ó800 PNG</button>
                    <button class="btn" onclick="downloadCanvasAsImage(this.parentNode.parentNode.canvas640, 'screenshot-${index + 1}-640x400.png')">üì• 640√ó400 PNG</button>
                    <button class="btn" onclick="downloadCanvasAsImage(this.parentNode.parentNode.canvas1280, 'screenshot-${index + 1}-1280x800.jpg', 'image/jpeg')">üì• 1280√ó800 JPG</button>
                    <button class="btn" onclick="downloadCanvasAsImage(this.parentNode.parentNode.canvas640, 'screenshot-${index + 1}-640x400.jpg', 'image/jpeg')">üì• 640√ó400 JPG</button>
                </div>
            `;
            
            container.appendChild(preview);
            container.canvas1280 = canvas1280;
            container.canvas640 = canvas640;
            
            document.getElementById('screenshotGrid').appendChild(container);
        }

        // Animation generation
        function generateAnimation() {
            const canvas = document.getElementById('animationCanvas');
            const ctx = canvas.getContext('2d');
            
            // Clear canvas
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, 1280, 720);
            
            // Add intro text
            ctx.fillStyle = '#ff3670';
            ctx.font = 'bold 48px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('üßú‚Äç‚ôÄÔ∏è Mermaid Visualizer', 640, 300);
            
            ctx.fillStyle = '#ffffff';
            ctx.font = '24px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif';
            ctx.fillText('Transform code into beautiful diagrams', 640, 350);
            ctx.fillText('with just one click!', 640, 390);
            
            ctx.textAlign = 'left';
        }

        function playAnimation() {
            if (!isAnimating) {
                isAnimating = true;
                animateSequence();
            }
        }

        function pauseAnimation() {
            isAnimating = false;
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
        }

        function animateSequence() {
            if (!isAnimating) return;
            
            const canvas = document.getElementById('animationCanvas');
            const ctx = canvas.getContext('2d');
            const progress = document.getElementById('animationProgress');
            
            // Slower animation - 20 seconds total (600 frames at 30fps)
            const totalFrames = 600;
            const progressPercent = (currentFrame / totalFrames) * 100;
            progress.style.width = progressPercent + '%';
            
            // Professional gradient background
            const gradient = ctx.createLinearGradient(0, 0, 1280, 720);
            gradient.addColorStop(0, '#667eea');
            gradient.addColorStop(0.5, '#764ba2');
            gradient.addColorStop(1, '#4facfe');
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 1280, 720);
            
            // Animation sequence based on current frame (much slower)
            if (currentFrame < 150) {
                // Intro sequence (5 seconds)
                drawIntroFrame(ctx, currentFrame);
            } else if (currentFrame < 300) {
                // Show webpage (5 seconds)
                drawWebpageFrame(ctx, currentFrame - 150);
            } else if (currentFrame < 400) {
                // Show extension icon (3.3 seconds)
                drawExtensionFrame(ctx, currentFrame - 300);
            } else if (currentFrame < 500) {
                // Show diagram appearing (3.3 seconds)
                drawDiagramFrame(ctx, currentFrame - 400);
            } else {
                // End sequence (3.3 seconds)
                drawEndFrame(ctx, currentFrame - 500);
            }
            
            currentFrame++;
            if (currentFrame >= totalFrames) {
                currentFrame = 0; // Loop
            }
            
            animationId = requestAnimationFrame(animateSequence);
        }

        function drawIntroFrame(ctx, frame) {
            // Much slower fade in over 5 seconds
            const alpha = Math.min(1, frame / 60);
            const scale = 0.8 + (alpha * 0.2); // Gentle scale animation
            
            ctx.save();
            ctx.translate(640, 360);
            ctx.scale(scale, scale);
            
            // Draw real icon if available
            if (iconImage && frame > 30) {
                const iconAlpha = Math.min(1, (frame - 30) / 60);
                ctx.globalAlpha = iconAlpha;
                ctx.drawImage(iconImage, -80, -120, 160, 160);
                ctx.globalAlpha = 1;
            }
            
            // Professional title
            ctx.fillStyle = `rgba(255, 255, 255, ${alpha})`;
            ctx.font = 'bold 56px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Mermaid Visualizer', 0, 80);
            
            // Subtitle with better timing
            if (frame > 45) {
                const subtitleAlpha = Math.min(1, (frame - 45) / 60);
                ctx.fillStyle = `rgba(255, 255, 255, ${subtitleAlpha * 0.9})`;
                ctx.font = '28px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif';
                ctx.fillText('Transform code into beautiful diagrams', 0, 130);
            }
            
            ctx.restore();
        }

        function drawWebpageFrame(ctx, frame) {
            // Fade in the browser window slowly
            const alpha = Math.min(1, frame / 90);
            
            ctx.save();
            ctx.globalAlpha = alpha;
            
            // Professional browser window
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(140, 120, 1000, 480);
            
            // Browser chrome with rounded corners
            ctx.fillStyle = '#f8f9fa';
            ctx.fillRect(140, 120, 1000, 50);
            
            // Address bar
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(200, 135, 700, 20);
            
            // URL text
            ctx.fillStyle = '#495057';
            ctx.font = '14px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('üêô github.com/IstiN/awesome-project/README.md', 210, 148);
            
            // Page title
            ctx.fillStyle = '#24292e';
            ctx.font = 'bold 24px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif';
            ctx.fillText('üìä Project Documentation', 160, 210);
            
            // Mermaid code block with better styling
            if (frame > 60) {
                const codeAlpha = Math.min(1, (frame - 60) / 60);
                ctx.globalAlpha = alpha * codeAlpha;
                
                // Code block background
                ctx.fillStyle = '#f6f8fa';
                ctx.fillRect(160, 240, 800, 200);
                
                // Code text
                ctx.fillStyle = '#24292e';
                ctx.font = '16px "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace';
                const code = [
                    '```mermaid',
                    'graph TD',
                    '    A[Start Process] --> B{Make Decision}',
                    '    B -->|Yes| C[Execute Action]',
                    '    B -->|No| D[Alternative Path]',
                    '    C --> E[Success]',
                    '    D --> E',
                    '```'
                ];
                
                code.forEach((line, i) => {
                    ctx.fillText(line, 180, 270 + i * 22);
                });
            }
            
            ctx.restore();
        }

        function drawExtensionFrame(ctx, frame) {
            // Previous frame content (keep webpage visible)
            drawWebpageFrame(ctx, 150);
            
            // Zoom animation to extension area
            const zoomProgress = Math.min(1, frame / 60);
            const zoomScale = 1 + (zoomProgress * 2);
            
            ctx.save();
            
            // Highlight extension icon area with smooth pulse
            const pulse = Math.sin((frame / 20) * Math.PI) * 0.4 + 0.8;
            
            // Extension toolbar background
            ctx.fillStyle = `rgba(248, 249, 250, ${pulse})`;
            ctx.fillRect(950, 30, 200, 60);
            
            // Highlight glow around our icon
            ctx.fillStyle = `rgba(255, 54, 112, ${pulse * 0.3})`;
            ctx.fillRect(1040, 40, 50, 50);
            
            // Draw our real extension icon
            if (iconImage && frame > 30) {
                const iconAlpha = Math.min(1, (frame - 30) / 30);
                ctx.globalAlpha = iconAlpha;
                ctx.drawImage(iconImage, 1045, 45, 40, 40);
                ctx.globalAlpha = 1;
            }
            
            // Click indicator
            if (frame > 60) {
                const clickAlpha = Math.sin((frame - 60) / 10 * Math.PI) * 0.8;
                ctx.fillStyle = `rgba(255, 255, 255, ${clickAlpha})`;
                ctx.beginPath();
                ctx.arc(1065, 65, 25, 0, Math.PI * 2);
                ctx.fill();
                
                // Click text
                ctx.fillStyle = `rgba(255, 54, 112, ${clickAlpha})`;
                ctx.font = 'bold 16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('Click!', 1065, 110);
            }
            
            ctx.restore();
        }

        function drawDiagramFrame(ctx, frame) {
            // Modal appearance animation
            const modalAlpha = Math.min(1, frame / 30);
            
            ctx.save();
            ctx.globalAlpha = modalAlpha;
            
            // Modal backdrop
            ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
            ctx.fillRect(0, 0, 1280, 720);
            
            // Modal window
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(190, 100, 900, 520);
            
            // Modal header
            ctx.fillStyle = '#f8f9fa';
            ctx.fillRect(190, 100, 900, 60);
            
            // Modal title
            ctx.fillStyle = '#24292e';
            ctx.font = 'bold 24px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('üßú‚Äç‚ôÄÔ∏è Mermaid Diagram Viewer', 210, 135);
            
            // Diagram area background
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(210, 180, 860, 420);
            
            ctx.restore();
            
            // Animated diagram nodes (appear one by one)
            const nodes = [
                { x: 320, y: 280, text: 'Start Process', type: 'rect' },
                { x: 640, y: 280, text: 'Decision', type: 'diamond' },
                { x: 480, y: 400, text: 'Execute', type: 'rect' },
                { x: 800, y: 400, text: 'Alternative', type: 'rect' },
                { x: 640, y: 520, text: 'Success', type: 'rect' }
            ];
            
            nodes.forEach((node, i) => {
                if (frame > i * 20 + 30) {
                    const nodeAlpha = Math.min(1, (frame - (i * 20 + 30)) / 20);
                    
                    ctx.save();
                    ctx.globalAlpha = nodeAlpha;
                    
                    if (node.type === 'diamond') {
                        // Diamond shape for decision
                        ctx.fillStyle = '#4facfe';
                        ctx.beginPath();
                        ctx.moveTo(node.x, node.y - 25);
                        ctx.lineTo(node.x + 60, node.y);
                        ctx.lineTo(node.x, node.y + 25);
                        ctx.lineTo(node.x - 60, node.y);
                        ctx.closePath();
                        ctx.fill();
                    } else {
                        // Rectangle for process
                        ctx.fillStyle = '#ff3670';
                        ctx.fillRect(node.x - 50, node.y - 20, 100, 40);
                    }
                    
                    // Node text
                    ctx.fillStyle = '#ffffff';
                    ctx.font = 'bold 14px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText(node.text, node.x, node.y + 5);
                    
                    ctx.restore();
                }
            });
            
            // Animated connections
            const connections = [
                { from: 0, to: 1 },
                { from: 1, to: 2 },
                { from: 1, to: 3 },
                { from: 2, to: 4 },
                { from: 3, to: 4 }
            ];
            
            connections.forEach((conn, i) => {
                if (frame > (i + 2) * 20 + 50) {
                    const fromNode = nodes[conn.from];
                    const toNode = nodes[conn.to];
                    
                    ctx.strokeStyle = '#667eea';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(fromNode.x, fromNode.y);
                    ctx.lineTo(toNode.x, toNode.y);
                    ctx.stroke();
                }
            });
        }

        function drawEndFrame(ctx, frame) {
            // Fade in slowly over 3.3 seconds
            const alpha = Math.min(1, frame / 90);
            const scale = 0.9 + (alpha * 0.1);
            
            ctx.save();
            ctx.translate(640, 360);
            ctx.scale(scale, scale);
            
            // Draw our icon if available
            if (iconImage && frame > 30) {
                const iconAlpha = Math.min(1, (frame - 30) / 60);
                ctx.globalAlpha = iconAlpha;
                ctx.drawImage(iconImage, -60, -120, 120, 120);
                ctx.globalAlpha = 1;
            }
            
            // Professional call to action
            ctx.fillStyle = `rgba(255, 255, 255, ${alpha})`;
            ctx.font = 'bold 48px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Experience the Future', 0, 40);
            ctx.fillText('of Diagram Visualization', 0, 90);
            
            if (frame > 60) {
                const subtitleAlpha = Math.min(1, (frame - 60) / 60);
                ctx.fillStyle = `rgba(255, 255, 255, ${subtitleAlpha * 0.9})`;
                ctx.font = '24px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif';
                ctx.fillText('Transform your workflow today', 0, 140);
                
                // Professional features
                const features = ['‚ö° One-click visualization', 'üåê Universal compatibility', 'üîí Privacy-first design'];
                ctx.font = '18px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif';
                features.forEach((feature, i) => {
                    ctx.fillText(feature, 0, 180 + i * 30);
                });
            }
            
            ctx.restore();
        }

        // Favicon generation using real icon
        function generateFavicon() {
            const canvas = document.getElementById('faviconCanvas');
            const ctx = canvas.getContext('2d');
            
            // Clear canvas
            ctx.clearRect(0, 0, 64, 64);
            
            if (iconImage) {
                // Draw our real icon scaled to favicon size
                ctx.drawImage(iconImage, 0, 0, 64, 64);
            } else {
                // Fallback if icon isn't loaded
                ctx.fillStyle = '#ff3670';
                ctx.fillRect(1, 1, 62, 62);
                
                ctx.fillStyle = 'white';
                ctx.translate(32, 32);
                ctx.scale(0.4, 0.4);
                
                // Simplified diagram elements
                ctx.fillRect(-15, -36, 30, 18);
                ctx.fillRect(-42, -9, 24, 18);
                ctx.fillRect(-12, -9, 24, 18);
                ctx.fillRect(18, -9, 24, 18);
                ctx.fillRect(-32, 18, 22, 16);
                ctx.fillRect(10, 18, 22, 16);
            }
        }

        function exportAnimationFrames() {
            // Export key frames
            const canvas = document.getElementById('animationCanvas');
            const originalFrame = currentFrame;
            
            const keyFrames = [0, 60, 120, 180, 240];
            keyFrames.forEach((frame, i) => {
                currentFrame = frame;
                animateSequence();
                downloadCanvasAsImage(canvas, `animation-frame-${i + 1}.png`);
            });
            
            currentFrame = originalFrame;
        }

        // Favicon generation
        function generateFavicon() {
            const canvas = document.getElementById('faviconCanvas');
            const ctx = canvas.getContext('2d');
            
            // Background
            ctx.fillStyle = '#ff3670';
            ctx.fillRect(0, 0, 64, 64);
            
            // Simple icon design
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(8, 8, 48, 48);
            
            ctx.fillStyle = '#ff3670';
            ctx.fillRect(16, 16, 32, 32);
            
            // Add some detail
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(20, 20, 8, 8);
            ctx.fillRect(36, 20, 8, 8);
            ctx.fillRect(20, 36, 24, 8);
        }

        function downloadFavicon() {
            const canvas = document.getElementById('faviconCanvas');
            downloadCanvasAsImage(canvas, 'favicon.png');
            
            // Show download link
            const downloadsDiv = document.getElementById('faviconDownloads');
            downloadsDiv.innerHTML = `
                <a href="#" class="download-link ready" onclick="downloadCanvasAsImage(document.getElementById('faviconCanvas'), 'favicon.png')">üì• Favicon PNG</a>
            `;
        }

        // Utility function to download canvas as image
        function downloadCanvasAsImage(canvas, filename, mimeType = 'image/png') {
            const link = document.createElement('a');
            link.download = filename;
            
            if (mimeType === 'image/jpeg') {
                // For JPEG, create a new canvas with white background
                const tempCanvas = document.createElement('canvas');
                tempCanvas.width = canvas.width;
                tempCanvas.height = canvas.height;
                const tempCtx = tempCanvas.getContext('2d');
                
                // Fill with white background
                tempCtx.fillStyle = '#ffffff';
                tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
                
                // Draw original canvas
                tempCtx.drawImage(canvas, 0, 0);
                
                link.href = tempCanvas.toDataURL(mimeType, 0.95);
            } else {
                link.href = canvas.toDataURL(mimeType);
            }
            
            link.click();
        }

        // Drag and drop functionality
        const uploadArea = document.querySelector('.upload-area');

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            processScreenshots(files);
        });

        // Initialize everything
        async function initializeAll() {
            try {
                console.log('üöÄ Starting promotional materials generator initialization...');
                
                // Load our real icon first
                console.log('üì• Loading icon...');
                await loadRealIcon();
                console.log('‚úÖ Icon loading completed');
                
                // Generate promotional materials with real icon
                console.log('üé® Generating promotional tiles...');
                generatePromoTiles();
                console.log('‚úÖ Promotional tiles generated');
                
                console.log('üéØ Generating favicon...');
                generateFavicon();
                console.log('‚úÖ Favicon generated');
                
                // Load our screenshots automatically
                console.log('üì∏ Loading screenshots...');
                loadOurScreenshots();
                
                // Initialize animation with first frame
                console.log('üé¨ Initializing animation...');
                generateAnimation();
                console.log('‚úÖ Animation initialized');
                
                console.log('üéâ Promotional materials generator fully initialized!');
                
                // Enable all buttons
                const buttons = document.querySelectorAll('button, .download-link');
                buttons.forEach(btn => {
                    btn.style.opacity = '1';
                    btn.style.pointerEvents = 'auto';
                });
                
            } catch (error) {
                console.error('‚ùå Error during initialization:', error);
                alert('There was an error initializing the promotional materials generator. Please check the console for details.');
            }
        }

        // Start initialization when page loads
        initializeAll();
    </script>
</body>
</html>